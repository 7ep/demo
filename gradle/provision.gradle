// This file provides tasks related to running commands on servers
// and copying files to/from those servers.

remotes {
    uitestbox {
        host = 'uitestbox'
        user = 'cuser'
        fileTransfer = 'scp'
    }
}

task deployToTest {
    doLast {
        ssh.runInOrder {
            session(remotes.uitestbox)
                    {
                        put from: '/var/lib/jenkins/workspace/demo/build/libs/demo-1.0.0.war', into: '~/demo.war'
                        execute 'sudo mv demo.war /opt/tomcat/webapps/'
                        execute 'rm -fr demo_tests'
                        execute 'git clone cuser@jenkinsbox:~/demo demo_tests --branch master'
                        execute 'cd demo_tests;pipenv install 2>/dev/null'
                    }
        }
        sleep 10 * 1000

    }
}
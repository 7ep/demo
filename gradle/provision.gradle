// This file provides tasks related to running commands on servers
// and copying files to/from those servers.

remotes {
    web01 {
        role 'masterNode'
        host = 'renomad.com'
        user = 'byron'
        identity = file(System.getProperty("user.home") + '/.ssh/id_rsa')
    }
}

task checkWebServers {
    doLast {
        ssh.run {
            session(remotes.web01) {
                // Execute a command
                def result = execute 'ls'

                // Any Gradle methods or properties are available in a session closure
                copy {
                    from "src/main/resources/example"
                    into "$buildDir/tmp"
                }

                // Also Groovy methods or properties are available in a session closure
                println result
            }
        }
    }
}

task deployToTest {
    // move the web app to the box in the proper place.
//    scp ("build/libs/demo*.war cuser@uitestbox:~/demo.war")
//    ssh ("cuser@uitestbox sudo mv demo.war /opt/tomcat/webapps/")
//
//    // need demo_tests on the box, that's where we have the UI tests located.
//    ssh ("cuser@uitestbox rm -fr demo_tests")
//    ssh ("cuser@uitestbox git clone cuser@jenkinsbox:~/demo demo_tests --branch master")
//    ssh ('cuser@uitestbox "cd demo_tests;pipenv install 2>/dev/null"')
//
//    // need a little time to wait for Tomcat to initialize the application...
//    sleep 10
}
pipeline {

  agent any


  environment {
    DEMO_PROJECT_HOME   =  '${env.WORKSPACE}'
    POSTGRES_BIN_DIR    = '/usr/pgsql-10/bin'
  }

  stages {

    stage('Build') {
      steps {
        sh 'gradle clean assemble'
        sh 'gradle flywayMigrate -i'
      }
    }

    stage('Test') {
      steps {
        sh 'gradle cucumber'
        sh 'gradle test'
        sh 'cp -a build/reports/bdd/cucumber-html-reports/* /var/www/cucumber/'
        sh 'cp -a build/reports/tests/test/* /var/www/unittest/'
      }

      post {
        always {
          junit 'build/test-results/test/*.xml'

        }
      }

    }

  }

}
